{% extends 'admin/base.html.twig' %}

{% block head_stylesheet %}

	{{ parent() }}

	{{ include('admin/inc/head-stylesheet/select2.html.twig') }}

{% endblock %}

{% block head_css %}

	{{ parent() }}

	<style type="text/css">

		.select2-selection,
        .select2-results__option {
            font-size: .825rem !important;
        }

	</style>

{% endblock %}

{% block body_content %}

    {{ parent() }}
    
    <h1 class="fs-2 d-flex justify-content-between">
		<span>{{ priceList.name }}</span>
		<span>{{ priceList.supplier.ciName }}</span>
	</h1>

    {% if priceAlert %}
        <div class="alert alert-danger" role="alert">
            Tato položka má chybně nastavenou prodejní cenu!
        </div>
    {% endif %}

    {% if parameterAlert %}
        <div class="alert alert-warning" role="alert">
            Tato položka nemá nastavené prodejní parametry!
        </div>
    {% endif %}

    <div class="row mb-4">

        <div class="col-lg-12">

            {{ form_start(form) }}

            {{ include('admin/price_list/_form.html.twig') }}

            <div class="float-start">
                <button type="submit" class="btn btn-success" name="submit_update">{{ 'action.update'|trans }}</button>
				<button type="submit" class="btn btn-success" name="submit_update_and_back">{{ 'action.update_and_back'|trans }}</button>
                <a href="{{ path('app_admin_price_list_index') }}" title="{{ 'action.back_to_list'|trans }}" class="btn btn-secondary">{{ 'action.back_to_list'|trans }}</a>
            </div>

            {{ form_end(form) }}

            {{ include('admin/price_list/_delete_form.html.twig') }}

        </div>

    </div>

{% endblock %}

{% block body_javascript %}

	{{ parent() }}

	{{ include('admin/inc/body-javascript/dropzone.html.twig') }}

	{{ include('admin/inc/body-javascript/select2.html.twig') }}

    {{ include('admin/inc/body-javascript/tinymce.html.twig') }}

{% endblock %}

{% block body_javascript_function %}

    {{ parent() }}

    var input = '#price_list_description';
    {{ include('admin/inc/body-javascript-function/tinymce.html.twig') }}

    {% if (image is defined) and (image is not null) %}
        $('.btn-delete-image').on('click', function(event) {
            event.preventDefault(); // Zabraňuje defaultnímu chování tlačítka

            if (confirm('Are you sure you want to delete this image?')) {
                fetch('{{ path("app_admin_price_list_image_delete", {"recordId": image.recordId}) }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(data => {
                            throw new Error(data.message || 'An unexpected error occurred');
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.status == 'ok') {
                        $('.image-detail').remove();
                    }
                })
                .catch((error) => {
                    console.error('There was a problem with the fetch operation:', error);
                });
            }
        });
    {% endif %}

{% endblock %}

{% block body_javascript_document_ready %}

	{{ parent() }}

	{{ include('admin/inc/body-javascript-document-ready/select2.html.twig') }}

    function toggleNumberOfPieces() {
        if ($('#price_list_purchaseMeasureUnit').val() == 9) {
            $('.number-of-pieces-in-package-wrapper').show();
        } else {
            $('.number-of-pieces-in-package-wrapper').hide();
            $('#price_list_numberOfPiecesInPackage').val(''); // Resetuje hodnotu při skrytí
        }
    }

    // Spuštění při načtení stránky
    toggleNumberOfPieces();

    // Reakce na změnu v selectu
    $('#price_list_purchaseMeasureUnit').change(function () {
        toggleNumberOfPieces();
    });

{% endblock %}
