{% extends 'admin/base.html.twig' %}

{% block head_stylesheet %}

    {{ parent() }}

    {{ include('admin/inc/head-stylesheet/select2.html.twig') }}

    {{ include('admin/inc/head-stylesheet/tagify.html.twig') }}

{% endblock %}

{% block body_content %}

<div class="row mb-4">

    <div class="col-lg-12">

        {{ form_start(form) }}

            {{ include('admin/article/_form.html.twig') }}

            <div class="float-start">
                <button type="submit" class="btn btn-success" name="submit_update">{{ 'action.update'|trans }}</button>
				<button type="submit" class="btn btn-success" name="submit_update_and_back">{{ 'action.update_and_back'|trans }}</button>
                <a href="{{ path('app_admin_article_index') }}" title="{{ 'action.back_to_list'|trans }}" class="btn btn-secondary">{{ 'action.back_to_list'|trans }}</a>
            </div>

        {{ form_end(form) }}

        {{ include('admin/article/_delete_form.html.twig') }}

    </div>

</div>

<!--begin::copy Toast-->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="copyToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header text-white bg-primary">
            <i class="fa-solid fa-location-dot fa-fw"></i>
            <strong class="ms-2 me-auto letter-spacing-1">Copy</strong>
            <small>právě teď</small>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">Data byla zkopírována do schránky</div>
    </div>
</div>
<!--end::copy Toast-->
    
{% endblock %}

{% block body_javascript %}

    {{ parent() }}

    {{ include('admin/inc/body-javascript/clipboard.html.twig') }}

    {{ include('admin/inc/body-javascript/select2.html.twig') }}

    {{ include('admin/inc/body-javascript/slugify.html.twig') }}

    {{ include('admin/inc/body-javascript/tagify.html.twig') }}

    {{ include('admin/inc/body-javascript/tinymce.html.twig') }}

{% endblock %}

{% block body_javascript_function %}

    {{ parent() }}

    {{ include('admin/inc/body-javascript-function/clipboard.html.twig') }}

    var inputSlugify = document.getElementById('article_name');
    var outputSlugify = document.getElementById('article_urlAlias');
    if (inputSlugify && outputSlugify) {
        {{ include('admin/inc/body-javascript-function/slugify.html.twig') }}
    } else {
        console.error('Article name or URL alias elements not found');
    }
    
    var inputTag = document.getElementById('article_tag');
    if (inputTag) {
        {{ include('admin/inc/body-javascript-function/tagify.html.twig') }}
    } else {
        console.error('Article tag element not found');
    }

    var input = '#article_perex, #article_text, #article_paidText';
    {{ include('admin/inc/body-javascript-function/tinymce.html.twig') }}

    {% if (image is defined) and (image is not null) %}
        $('.btn-delete-image').on('click', function(event) {
            event.preventDefault(); // Zabraňuje defaultnímu chování tlačítka

            if (confirm('Are you sure you want to delete this image?')) {
                fetch('{{ path("app_admin_article_image_delete", {"recordId": image.recordId}) }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(data => {
                            throw new Error(data.message || 'An unexpected error occurred');
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.status == 'ok') {
                        $('.image-detail').remove();
                    }
                })
                .catch((error) => {
                    console.error('There was a problem with the fetch operation:', error);
                });
            }
        });
    {% endif %}

{% endblock %}

{% block body_javascript_document_ready %}

    {{ parent() }}

    {{ include('admin/inc/body-javascript-document-ready/select2.html.twig') }}

{% endblock %}
